<app-layout [data]="brandingDetails.layout">
  <div class="set-password-card">
    <h2>{{brandingDetails.title}}</h2>
    <p class="subtitle">
      {{brandingDetails.desciption}}<br>
      <strong>{{ email }}</strong>
    </p>

    @if(successMessage){
      <div class="success-msg">
      {{ successMessage }}
    </div>
    }
    
    @if(errorMessage){
      <div class="error-msg">
      {{ errorMessage }}
    </div>
    }
    

    <form (ngSubmit)="onSubmit()" #setPasswordForm="ngForm">
      <!-- New Password Field -->
      <div class="input-box">
        <label>New Password</label>
        <input 
          [type]="showPassword ? 'text' : 'password'"
          name="newPassword" 
          [(ngModel)]="newPassword" 
          required 
          minlength="6"
          placeholder="Enter your new password"
        />
        <span class="icon toggle-password" (click)="togglePasswordVisibility()">
          <ion-icon [name]="showPassword ? 'eye-off' : 'eye'"></ion-icon>
        </span>
      </div>

      @if(newPassword){
        <!-- Password Strength Indicator -->
      <div class="password-strength">
        <div class="strength-bar">
          <div [class]="'strength-fill ' + getPasswordStrengthClass()"></div>
        </div>
        <p class="strength-text" [class]="getPasswordStrengthClass()">
          {{brandingDetails.passwordStrengthText}}: {{ getPasswordStrengthText() }}
        </p>
      </div>
      }
      

      <!-- Confirm Password Field -->
      <div class="input-box">
        <label>Confirm Password</label>
        <input 
          [type]="showConfirmPassword ? 'text' : 'password'"
          name="confirmPassword" 
          [(ngModel)]="confirmPassword" 
          required 
          minlength="6"
          placeholder="Confirm your new password"
        />
        <span class="icon toggle-password" (click)="toggleConfirmPasswordVisibility()">
          <ion-icon [name]="showConfirmPassword ? 'eye-off' : 'eye'"></ion-icon>
        </span>
      </div>

      <!-- Password Requirements -->
      <div class="password-requirements">
        <p class="requirements-title">{{brandingDetails.requirementsTitle}}</p>
        <ul>
          <li [class.met]="hasMinLength()">
            <ion-icon [name]="getRequirementIcon(hasMinLength())"></ion-icon>
            {{brandingDetails.requirements.length}}
          </li>
          <li [class.met]="hasUpperAndLowerCase()">
            <ion-icon [name]="getRequirementIcon(hasUpperAndLowerCase())"></ion-icon>
            {{brandingDetails.requirements.case}}
          </li>
          <li [class.met]="hasNumber()">
            <ion-icon [name]="getRequirementIcon(hasNumber())"></ion-icon>
            {{brandingDetails.requirements.number}}
          </li>
        </ul>
      </div>

      <button type="submit" [disabled]="!setPasswordForm.form.valid || isSubmitting || newPassword !== confirmPassword">
        {{ isSubmitting ? 'Resetting Password...' : 'Reset Password' }}
      </button>
    </form>

    <div class="back-to-login">
      <a [routerLink]="['/login']">
        <ion-icon name="arrow-back"></ion-icon>
        {{brandingDetails.formButtons.login}}
      </a>
    </div>
  </div>
</app-layout>