<div class="login-container">
    <div class="login-container-inner">
      
      <div class="login-left">
        <div class="login-card">
          
          <!-- Messages -->
          <p *ngIf="errorMessage" class="error-msg">{{ errorMessage }}</p>
          <p *ngIf="successMessage" class="success-msg">{{ successMessage }}</p>
  
          <!-- ==================== LOGIN VIEW ==================== -->
          <div *ngIf="currentView === 'login'">
            <h2>Sign In</h2>
            <h3>Custom Login</h3>
  
            <form (ngSubmit)="login()" #loginForm="ngForm">
              <div class="form-group">
                <label>Username:</label>
                <input
                  type="text"
                  name="username"
                  [(ngModel)]="loginData.username"
                  required
                  placeholder="Enter your username"
                  autocomplete="username"
                />
              </div>
  
              <div class="form-group">
                <label>Password:</label>
                <input
                  type="password"
                  name="password"
                  [(ngModel)]="loginData.password"
                  required
                  placeholder="Enter your password"
                  autocomplete="current-password"
                />
              </div>
  
              <div class="forgot-link-container">
                <a (click)="switchView('forgot-password')" class="link">Forgot Password?</a>
              </div>
  
              <button type="submit" [disabled]="!loginForm.form.valid || loading">
                {{ loading ? 'Logging in...' : 'Login' }}
              </button>
            </form>
  
            <button class="signup-btn" (click)="switchView('signup')">Sign Up</button>
  
            <div class="divider">OR</div>
  
            <button class="azure-btn" (click)="goToAzureLogin()">Login with Azure AD</button>
          </div>
  
          <!-- ==================== SIGNUP VIEW ==================== -->
          <div *ngIf="currentView === 'signup'">
            <h2>Create Account</h2>
            <h3>Sign Up</h3>
  
            <form (ngSubmit)="signup()" #signupForm="ngForm">
              <div class="form-group">
                <label>Username:</label>
                <input
                  type="text"
                  name="username"
                  [(ngModel)]="signupData.username"
                  required
                  minlength="3"
                  placeholder="Choose a username"
                  autocomplete="username"
                />
                <small
                  *ngIf="signupForm.controls['username']?.invalid && signupForm.controls['username']?.touched"
                  class="error-text"
                >
                  Username must be at least 3 characters
                </small>
              </div>
  
              <div class="form-group">
                <label>Email:</label>
                <input
                  type="email"
                  name="email"
                  [(ngModel)]="signupData.email"
                  required
                  email
                  placeholder="Enter your email"
                  autocomplete="email"
                />
                <small
                  *ngIf="signupForm.controls['email']?.invalid && signupForm.controls['email']?.touched"
                  class="error-text"
                >
                  Please enter a valid email
                </small>
              </div>
  
              <div class="form-group">
                <label>Password:</label>
                <input
                  type="password"
                  name="password"
                  [(ngModel)]="signupData.password"
                  required
                  minlength="6"
                  placeholder="Create a password"
                  autocomplete="new-password"
                />
                <small
                  *ngIf="signupForm.controls['password']?.invalid && signupForm.controls['password']?.touched"
                  class="error-text"
                >
                  Password must be at least 6 characters
                </small>
              </div>
  
              <button type="submit" [disabled]="!signupForm.form.valid || loading">
                {{ loading ? 'Creating Account...' : 'Sign Up' }}
              </button>
            </form>
  
            <button class="signup-btn" (click)="switchView('login')">Back to Login</button>
          </div>
  
          <!-- ==================== FORGOT PASSWORD VIEW ==================== -->
          <div *ngIf="currentView === 'forgot-password'">
            <h2>Forgot Password</h2>
            <h3>Reset Your Password</h3>
  
            <form (ngSubmit)="sendPasswordResetOtp()" #forgotForm="ngForm">
              <div class="form-group">
                <label>Email Address:</label>
                <input
                  type="email"
                  name="email"
                  [(ngModel)]="forgotPasswordEmail"
                  required
                  email
                  placeholder="Enter your registered email"
                  autocomplete="email"
                />
              </div>
  
              <button type="submit" [disabled]="!forgotForm.form.valid || loading">
                {{ loading ? 'Sending OTP...' : 'Send OTP' }}
              </button>
            </form>
  
            <button class="signup-btn" (click)="switchView('login')">Back to Login</button>
          </div>
  
          <!-- ==================== VERIFY OTP VIEW ==================== -->
          <div *ngIf="currentView === 'verify-otp'">
            <h2>Verify OTP</h2>
            <h3>Enter the code sent to your email</h3>
  
            <form (ngSubmit)="verifyOtp()" #otpForm="ngForm">
              <div class="form-group">
                <label>OTP Code:</label>
                <input
                  type="text"
                  name="otp"
                  [(ngModel)]="otpCode"
                  required
                  maxlength="6"
                  placeholder="Enter 6-digit OTP"
                  autocomplete="one-time-code"
                />
              </div>
  
              <button type="submit" [disabled]="!otpForm.form.valid || loading">
                {{ loading ? 'Verifying...' : 'Verify OTP' }}
              </button>
            </form>
  
            <button class="signup-btn" (click)="switchView('forgot-password')">Resend OTP</button>
          </div>
  
          <!-- ==================== RESET PASSWORD VIEW ==================== -->
          <div *ngIf="currentView === 'reset-password'">
            <h2>Reset Password</h2>
            <h3>Enter your new password</h3>
  
            <form (ngSubmit)="resetPassword()" #resetForm="ngForm">
              <div class="form-group">
                <label>New Password:</label>
                <input
                  type="password"
                  name="newPassword"
                  [(ngModel)]="newPassword"
                  required
                  minlength="6"
                  placeholder="Enter new password"
                  autocomplete="new-password"
                />
                <small
                  *ngIf="resetForm.controls['newPassword']?.invalid && resetForm.controls['newPassword']?.touched"
                  class="error-text"
                >
                  Password must be at least 6 characters
                </small>
              </div>
  
              <div class="form-group">
                <label>Confirm Password:</label>
                <input
                  type="password"
                  name="confirmPassword"
                  [(ngModel)]="confirmPassword"
                  required
                  placeholder="Re-enter new password"
                  autocomplete="new-password"
                />
              </div>
  
              <button type="submit" [disabled]="!resetForm.form.valid || loading">
                {{ loading ? 'Resetting...' : 'Reset Password' }}
              </button>
            </form>
  
            <button class="signup-btn" (click)="switchView('login')">Back to Login</button>
          </div>
  
        </div>
      </div>
  
      <div class="login-right">
        <img src="../../../assets/clarium.jpg" alt="clarium" class="login-image" />
      </div>
  
    </div>
  </div>